{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\pc\\\\Desktop\\\\asira_core\\\\src\\\\components\\\\rolePermission\\\\rolePermissionEdit.js\";\nimport React from 'react';\nimport { Redirect } from 'react-router-dom';\nimport CheckBoxClass from '../subComponent/CheckBox';\nimport Loader from 'react-loader-spinner';\nimport swal from 'sweetalert';\nimport { createStructuredSelector } from 'reselect';\nimport { connect } from 'react-redux';\nimport { withRouter } from 'react-router';\nimport { withStyles } from '@material-ui/styles';\nimport { compose } from 'redux';\nimport { getRoleFunction, patchRolePermissionFunction } from './saga';\nimport { constructRolePermission, checkingRole, checkingSystem } from './function';\nimport { getToken } from '../index/token';\nimport { destructRolePermission } from './function';\n\nconst styles = theme => ({\n  container: {\n    flexGrow: 1\n  }\n});\n\nclass rolePermissionEdit extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this._isMounted = false;\n    this.state = {\n      diKlik: false,\n      errorMessage: '',\n      listAllRolePermission: [],\n      listRolePermission: [],\n      listRole: {},\n      roleId: 0,\n      nameRole: '',\n      system: '',\n      loading: true,\n      disabled: true\n    };\n\n    this.refresh = async function () {\n      const param = {};\n      param.roleId = this.state.roleId;\n      const data = await getRoleFunction(param);\n\n      if (data) {\n        const listRolePermission = destructRolePermission(data.dataRole && data.dataRole.permissions || []);\n\n        if (!data.error) {\n          this.setState({\n            listRole: data.dataRole,\n            nameRole: data.dataRole.name,\n            system: data.dataRole.system,\n            listRolePermission,\n            listAllRolePermission: checkingSystem(this.state.roleId, [data.dataRole]),\n            loading: false\n          });\n        } else {\n          this.setState({\n            errorMessage: data.error,\n            disabled: true,\n            loading: false\n          });\n        }\n      }\n    };\n\n    this.btnCancel = () => {\n      this.setState({\n        diKlik: true\n      });\n    };\n\n    this.btnSave = () => {\n      this.setState({\n        loading: true\n      });\n      const listRolePermission = this.state.listRolePermission;\n      const dataRolePermission = {};\n      dataRolePermission.id = parseInt(this.state.listRole.id);\n      dataRolePermission.name = this.state.nameRole;\n      dataRolePermission.system = this.state.system;\n      dataRolePermission.permissions = constructRolePermission(listRolePermission);\n      const param = {\n        roleId: parseInt(this.state.listRole.id),\n        dataRolePermission\n      };\n      this.patchRolePermission(param);\n    };\n\n    this.patchRolePermission = async function (param) {\n      const data = await patchRolePermissionFunction(param);\n\n      if (data) {\n        if (!data.error) {\n          swal(\"Success\", \"Role Permission berhasil di ubah\", \"success\");\n          this.setState({\n            diKlik: true,\n            loading: false\n          });\n        } else {\n          this.setState({\n            errorMessage: data.error,\n            disabled: true,\n            loading: false\n          });\n        }\n      }\n    };\n\n    this.isRoleBank = role => {\n      let flag = false;\n      const dataRole = this.state.listRole;\n\n      if (role && role !== 0) {\n        for (const key in dataRole) {\n          if (dataRole[key].id.toString() === role.toString() && dataRole[key].system.toString().toLowerCase().includes('dashboard')) {\n            flag = true;\n            break;\n          }\n        }\n      }\n\n      return flag;\n    };\n\n    this.onChangeCheck = e => {\n      const profileUserAll = Object.assign({}, this.state.listAllRolePermission);\n      const profileUser = Object.assign({}, this.state.listRolePermission);\n      const profileUserNew = [];\n      let flag = false;\n      let modules = '';\n\n      for (const key in profileUserAll) {\n        if (profileUserAll[key].id.toString().trim() === e.target.value.toString().trim()) {\n          modules = profileUserAll[key].modules;\n\n          for (const keyRole in profileUser) {\n            if (profileUser[keyRole].id.toString().trim() !== e.target.value.toString().trim()) {\n              profileUserNew.push(profileUser[keyRole]);\n            } else {\n              flag = true;\n            }\n          }\n        }\n      }\n\n      if (!flag) {\n        const modulesSplit = modules.split(' ');\n\n        for (const key in modulesSplit) {\n          profileUserNew.push({\n            id: e.target.value,\n            modules: modulesSplit[key]\n          });\n        }\n      }\n\n      this.setState({\n        listRolePermission: profileUserNew\n      });\n    };\n  }\n\n  componentDidMount() {\n    this._isMounted = true;\n    this.setState({\n      roleId: this.props.match.params.id\n    }, () => {\n      this.refresh();\n    });\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  componentWillReceiveProps(newProps) {\n    this.setState({\n      errorMessage: newProps.error\n    });\n  }\n\n  render() {\n    if (this.state.diKlik) {\n      return React.createElement(Redirect, {\n        to: \"/listRolePermission\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      });\n    } else if (this.state.loading) {\n      return React.createElement(\"div\", {\n        key: \"zz\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        align: \"center\",\n        colSpan: 6,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      }, React.createElement(Loader, {\n        type: \"Circles\",\n        color: \"#00BFFF\",\n        height: \"40\",\n        width: \"40\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      })));\n    } else if (getToken()) {\n      return React.createElement(\"div\", {\n        className: \"container mt-4\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203\n        },\n        __self: this\n      }, React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      }, \"Role Permission - Ubah\"), React.createElement(\"hr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }), React.createElement(\"form\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"form-group row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        className: \"col-sm-2 col-form-label\",\n        style: {\n          lineHeight: 3.5\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }, \"Role Name\"), React.createElement(\"label\", {\n        className: \"col-sm-4 col-form-label\",\n        style: {\n          lineHeight: 3.5\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213\n        },\n        __self: this\n      }, this.state.listRole && this.state.listRole.name)), React.createElement(\"div\", {\n        className: \"form-group row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"col-12\",\n        style: {\n          color: \"red\",\n          fontSize: \"15px\",\n          textAlign: 'left'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219\n        },\n        __self: this\n      }, this.state.errorMessage), React.createElement(\"div\", {\n        className: \"col-12\",\n        style: {\n          color: \"black\",\n          fontSize: \"15px\",\n          textAlign: 'left'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      }, React.createElement(CheckBoxClass, {\n        label: `${this.state.system} - Permission Setup`,\n        modulesName: \"Menu\",\n        data: this.state.listAllRolePermission,\n        id: \"id\",\n        labelName: \"label\",\n        modules: \"menu\",\n        labelPlacement: \"top\",\n        onChange: this.onChangeCheck,\n        onChecked: id => checkingRole(this.state.listRolePermission, id),\n        style: {\n          width: '97%'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"form-group row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"col-sm-12 ml-3 mt-3\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        type: \"button\",\n        value: \"Ubah\",\n        className: \"btn btn-success\",\n        onClick: this.btnSave,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240\n        },\n        __self: this\n      }), React.createElement(\"input\", {\n        type: \"button\",\n        value: \"Batal\",\n        className: \"btn ml-2\",\n        onClick: this.btnCancel,\n        style: {\n          backgroundColor: \"grey\",\n          color: \"white\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      })))));\n    } else if (!getToken()) {\n      return React.createElement(Redirect, {\n        to: \"/login\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251\n        },\n        __self: this\n      });\n    }\n  }\n\n}\n\nexport function mapDispatchToProps(dispatch) {\n  return {//   getSourceTransaction: () => {\n    //     dispatch(sourceTransactionRequest());\n    //   handleRedirect: (route) => {\n    //     dispatch(push(route));\n    //   },\n  };\n}\nexport const mapStateToProps = createStructuredSelector({// user: getUserState(),\n  // menu: getMenu(),\n});\nconst withConnect = connect(mapStateToProps, mapDispatchToProps);\nconst withStyle = withStyles(styles);\nexport default compose(withConnect, withStyle, withRouter)(rolePermissionEdit);","map":{"version":3,"sources":["C:/Users/pc/Desktop/asira_core/src/components/rolePermission/rolePermissionEdit.js"],"names":["React","Redirect","CheckBoxClass","Loader","swal","createStructuredSelector","connect","withRouter","withStyles","compose","getRoleFunction","patchRolePermissionFunction","constructRolePermission","checkingRole","checkingSystem","getToken","destructRolePermission","styles","theme","container","flexGrow","rolePermissionEdit","Component","_isMounted","state","diKlik","errorMessage","listAllRolePermission","listRolePermission","listRole","roleId","nameRole","system","loading","disabled","refresh","param","data","dataRole","permissions","error","setState","name","btnCancel","btnSave","dataRolePermission","id","parseInt","patchRolePermission","isRoleBank","role","flag","key","toString","toLowerCase","includes","onChangeCheck","e","profileUserAll","Object","assign","profileUser","profileUserNew","modules","trim","target","value","keyRole","push","modulesSplit","split","componentDidMount","props","match","params","componentWillUnmount","componentWillReceiveProps","newProps","render","lineHeight","color","fontSize","textAlign","width","backgroundColor","mapDispatchToProps","dispatch","mapStateToProps","withConnect","withStyle"],"mappings":"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","sourcesContent":["import React from 'react'\r\nimport { Redirect } from 'react-router-dom'\r\nimport CheckBoxClass from '../subComponent/CheckBox';\r\nimport Loader from 'react-loader-spinner'\r\nimport swal from 'sweetalert';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { connect } from 'react-redux';\r\nimport { withRouter } from 'react-router';\r\nimport { withStyles } from '@material-ui/styles';\r\nimport { compose } from 'redux';\r\nimport { getRoleFunction, patchRolePermissionFunction } from './saga'\r\nimport { constructRolePermission, checkingRole, checkingSystem } from './function'\r\nimport { getToken } from '../index/token';\r\nimport { destructRolePermission } from './function';\r\n\r\nconst styles = (theme) => ({\r\n    container: {\r\n      flexGrow: 1,\r\n    },\r\n  });\r\n\r\n\r\nclass rolePermissionEdit extends React.Component{\r\n    _isMounted = false;\r\n\r\n    state = {\r\n      diKlik:false,\r\n      errorMessage:'',\r\n      listAllRolePermission: [],\r\n      listRolePermission: [],\r\n      listRole : {},\r\n      roleId: 0,\r\n      nameRole: '',\r\n      system: '',\r\n      loading: true,\r\n      disabled:true,\r\n    };\r\n\r\n    componentDidMount(){\r\n      this._isMounted = true;\r\n      this.setState({\r\n        roleId: this.props.match.params.id,\r\n      },() => {\r\n        this.refresh();\r\n      })\r\n    }\r\n    \r\n    componentWillUnmount() {\r\n      this._isMounted = false;\r\n    }\r\n\r\n    refresh = async function(){\r\n      const param = {};\r\n      param.roleId = this.state.roleId;\r\n\r\n      const data = await getRoleFunction(param);\r\n\r\n      if(data) {\r\n          const listRolePermission = destructRolePermission((data.dataRole && data.dataRole.permissions) || [])\r\n          \r\n          if(!data.error) {\r\n            this.setState({\r\n              listRole: data.dataRole,\r\n              nameRole: data.dataRole.name,\r\n              system: data.dataRole.system,\r\n              listRolePermission,\r\n              listAllRolePermission: checkingSystem(this.state.roleId, [data.dataRole]),\r\n              loading: false,\r\n            })\r\n          } else {\r\n            this.setState({\r\n              errorMessage: data.error,\r\n              disabled: true,\r\n              loading: false,\r\n            })\r\n          }      \r\n      }\r\n    }\r\n\r\n    btnCancel = ()=>{\r\n      this.setState({diKlik:true})\r\n    }\r\n    componentWillReceiveProps(newProps){\r\n      this.setState({errorMessage:newProps.error})\r\n    }\r\n\r\n    btnSave = () =>{ \r\n      this.setState({loading: true})\r\n\r\n      const listRolePermission = this.state.listRolePermission;\r\n      const dataRolePermission = {};\r\n      \r\n      dataRolePermission.id = parseInt(this.state.listRole.id);\r\n      dataRolePermission.name = this.state.nameRole;\r\n      dataRolePermission.system = this.state.system\r\n      dataRolePermission.permissions = constructRolePermission(listRolePermission);\r\n\r\n      const param = {\r\n        roleId: parseInt(this.state.listRole.id),\r\n        dataRolePermission,\r\n      };\r\n      \r\n      this.patchRolePermission(param)\r\n        \r\n    }\r\n\r\n    patchRolePermission = async function(param) {\r\n      const data = await patchRolePermissionFunction(param)\r\n\r\n      if(data) {\r\n        if(!data.error) {\r\n          swal(\"Success\",\"Role Permission berhasil di ubah\",\"success\")\r\n          this.setState({\r\n            diKlik: true,\r\n            loading: false,\r\n          })\r\n        } else {\r\n          this.setState({\r\n            errorMessage: data.error,\r\n            disabled: true,\r\n            loading: false,\r\n          })\r\n        }      \r\n      }\r\n    }\r\n\r\n    isRoleBank = (role) => {\r\n      let flag = false;\r\n      const dataRole = this.state.listRole;\r\n\r\n      if(role && role !== 0) {\r\n        for(const key in dataRole) {\r\n          if(dataRole[key].id.toString() === role.toString() && dataRole[key].system.toString().toLowerCase().includes('dashboard')) {\r\n            flag = true;\r\n            break;\r\n          }\r\n        }\r\n        \r\n      } \r\n\r\n      return flag;\r\n    }\r\n\r\n    onChangeCheck = (e) => {\r\n      const profileUserAll = Object.assign({}, this.state.listAllRolePermission);\r\n      const profileUser = Object.assign({}, this.state.listRolePermission);\r\n      const profileUserNew = [];\r\n\r\n      let flag = false;\r\n      let modules = '';\r\n  \r\n      for (const key in profileUserAll) {\r\n        if (\r\n          profileUserAll[key].id.toString().trim() ===\r\n          e.target.value.toString().trim()\r\n        ) {\r\n          modules = profileUserAll[key].modules;\r\n\r\n          for(const keyRole in profileUser) {\r\n            if(profileUser[keyRole].id.toString().trim() !== e.target.value.toString().trim()) {\r\n              profileUserNew.push(profileUser[keyRole])\r\n            } else {\r\n              flag = true;\r\n            }\r\n          }\r\n        } \r\n      }\r\n  \r\n      if (!flag) {\r\n        const modulesSplit = modules.split(' ');\r\n\r\n        for(const key in modulesSplit) {\r\n          profileUserNew.push({\r\n            id: e.target.value,\r\n            modules: modulesSplit[key],\r\n          });\r\n        } \r\n      }\r\n      \r\n      this.setState({\r\n        listRolePermission: profileUserNew,\r\n      });\r\n    };\r\n\r\n    render(){\r\n        if(this.state.diKlik){\r\n            return <Redirect to='/listRolePermission'/>            \r\n        } else if (this.state.loading){\r\n          return  (\r\n            <div  key=\"zz\">\r\n              <div align=\"center\" colSpan={6}>\r\n                <Loader \r\n                  type=\"Circles\"\r\n                  color=\"#00BFFF\"\r\n                  height=\"40\"\t\r\n                  width=\"40\"\r\n                />   \r\n              </div>\r\n            </div>\r\n          )\r\n        } else if(getToken()){\r\n          return(\r\n            <div className=\"container mt-4\">\r\n              <h3>Role Permission - Ubah</h3>\r\n              \r\n              <hr/>\r\n              \r\n              <form>\r\n                <div className=\"form-group row\">                   \r\n                  <label className=\"col-sm-2 col-form-label\" style={{lineHeight:3.5}}>\r\n                    Role Name\r\n                  </label>\r\n                  <label className=\"col-sm-4 col-form-label\" style={{lineHeight:3.5}}>\r\n                    {this.state.listRole && this.state.listRole.name}\r\n                  </label>               \r\n                </div>\r\n\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-12\" style={{color:\"red\",fontSize:\"15px\",textAlign:'left'}}>\r\n                        {this.state.errorMessage}\r\n                    </div>     \r\n                    <div className=\"col-12\" style={{color:\"black\",fontSize:\"15px\",textAlign:'left'}}>\r\n                        <CheckBoxClass\r\n                          label={`${this.state.system} - Permission Setup`}\r\n                          modulesName=\"Menu\"\r\n                          data={this.state.listAllRolePermission}\r\n                          id=\"id\"\r\n                          labelName=\"label\"\r\n                          modules=\"menu\"      \r\n                          labelPlacement= \"top\"                       \r\n                          onChange={this.onChangeCheck}\r\n                          onChecked={(id) => checkingRole(this.state.listRolePermission, id)}\r\n                          style={{ width: '97%'}}\r\n                        />\r\n                    </div>           \r\n                </div>\r\n                \r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-12 ml-3 mt-3\">\r\n                      <input type=\"button\" value=\"Ubah\" className=\"btn btn-success\" onClick={this.btnSave} />\r\n                      <input type=\"button\" value=\"Batal\" className=\"btn ml-2\" onClick={this.btnCancel} style={{backgroundColor:\"grey\",color:\"white\"}}/>\r\n                    </div>\r\n                </div>\r\n                \r\n              </form>\r\n            \r\n            </div>\r\n          )\r\n        } else if(!getToken()){\r\n          return (\r\n            <Redirect to='/login' />\r\n          )    \r\n        }\r\n       \r\n    }\r\n}\r\n\r\nexport function mapDispatchToProps(dispatch) {\r\n    return {\r\n    //   getSourceTransaction: () => {\r\n    //     dispatch(sourceTransactionRequest());\r\n    //   handleRedirect: (route) => {\r\n    //     dispatch(push(route));\r\n    //   },\r\n    };\r\n}\r\n  \r\nexport const mapStateToProps = createStructuredSelector({\r\n  // user: getUserState(),\r\n  // menu: getMenu(),\r\n});\r\n\r\nconst withConnect = connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n);\r\n\r\nconst withStyle = withStyles(styles);\r\n\r\nexport default compose(\r\n    withConnect,\r\n    withStyle,\r\n    withRouter\r\n  )(rolePermissionEdit);"]},"metadata":{},"sourceType":"module"}